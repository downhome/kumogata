<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Kumogata : Kumogata is a tool for AWS CloudFormation.  It can define a template in Ruby DSL.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Kumogata</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/winebarrel/kumogata">View on GitHub</a>

          <h1 id="project_title">Kumogata</h1>
          <h2 id="project_tagline">Kumogata is a tool for AWS CloudFormation.  It can define a template in Ruby DSL.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/winebarrel/kumogata/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/winebarrel/kumogata/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="kumogata" class="anchor" href="#kumogata" aria-hidden="true"><span class="octicon octicon-link"></span></a>Kumogata</h1>

<p>Kumogata is a tool for <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a>.</p>

<p>This is a <code>format converter</code> + <code>useful tool</code>.
It supports the following format:</p>

<ul>
<li>JSON</li>
<li>Ruby</li>
<li>YAML</li>
<li>JavaScript</li>
<li>CoffeeScript (experimental)</li>
<li>JSON5 (experimental)</li>
</ul>

<p><a href="http://badge.fury.io/rb/kumogata"><img src="https://badge.fury.io/rb/kumogata.png?201406152020" alt="Gem Version"></a>
<a href="https://travis-ci.org/winebarrel/kumogata"><img src="https://travis-ci.org/winebarrel/kumogata.svg?branch=master" alt="Build Status"></a></p>

<p>It can define a template in Ruby DSL, such as:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">AWSTemplateFormatVersion</span> <span class="pl-s1"><span class="pl-pds">"</span>2010-09-09<span class="pl-pds">"</span></span>

<span class="pl-vo">Description</span> (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).undent</span>
<span class="pl-s1">  Kumogata Sample Template</span>
<span class="pl-s1">  You can use Here document!</span>
<span class="pl-s1"><span class="pl-pds">EOS</span></span>

<span class="pl-vo">Parameters</span> <span class="pl-k">do</span>
  <span class="pl-vo">InstanceType</span> <span class="pl-k">do</span>
    <span class="pl-vo">Default</span> <span class="pl-s1"><span class="pl-pds">"</span>t1.micro<span class="pl-pds">"</span></span>
    <span class="pl-vo">Description</span> <span class="pl-s1"><span class="pl-pds">"</span>Instance Type<span class="pl-pds">"</span></span>
    <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-vo">Resources</span> <span class="pl-k">do</span>
  myEC2Instance <span class="pl-k">do</span>
    <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>
    <span class="pl-vo">Properties</span> <span class="pl-k">do</span>
      <span class="pl-vo">ImageId</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>
      <span class="pl-vo">InstanceType</span> { <span class="pl-vo">Ref</span> <span class="pl-s1"><span class="pl-pds">"</span>InstanceType<span class="pl-pds">"</span></span> }
      <span class="pl-vo">KeyName</span> <span class="pl-s1"><span class="pl-pds">"</span>your_key_name<span class="pl-pds">"</span></span>

      <span class="pl-vo">UserData</span> <span class="pl-k">do</span>
        <span class="pl-vo">Fn__Base64</span> (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).undent</span>
<span class="pl-s1">          #!/bin/bash</span>
<span class="pl-s1">          yum install -y httpd</span>
<span class="pl-s1">          service httpd start</span>
<span class="pl-s1"><span class="pl-pds">        EOS</span></span>
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-vo">Outputs</span> <span class="pl-k">do</span>
  <span class="pl-vo">AZ</span> <span class="pl-k">do</span>
    <span class="pl-vo">Value</span> <span class="pl-k">do</span>
      <span class="pl-vo">Fn__GetAtt</span> <span class="pl-s1"><span class="pl-pds">"</span>myEC2Instance<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>AvailabilityZone<span class="pl-pds">"</span></span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>Ruby template structure is almost the same as <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-structure.html">JSON template</a>.</p>

<p>(<strong>You can also use JSON templates</strong>)</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<pre><code>$ gem install kumogata
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<pre><code>Usage: kumogata &lt;command&gt; [args] [options]

Commands:
  create         PATH_OR_URL [STACK_NAME]   Create resources as specified in the template
  validate       PATH_OR_URL                Validate a specified template
  convert        PATH_OR_URL                Convert a template format
  update         PATH_OR_URL STACK_NAME     Update a stack as specified in the template
  delete         STACK_NAME                 Delete a specified stack
  list           [STACK_NAME]               List summary information for stacks
  export         STACK_NAME                 Export a template from a specified stack
  show-events    STACK_NAME                 Show events for a specified stack
  show-outputs   STACK_NAME                 Show outputs for a specified stack
  show-resources STACK_NAME                 Show resources for a specified stack
  diff           PATH_OR_URL1 PATH_OR_URL2  Compare templates logically (file, http://..., stack://...)

Options:
    -k, --access-key ACCESS_KEY
    -s, --secret-key SECRET_KEY
    -r, --region REGION
        --config PATH
        --profile CONFIG_PROFILE
        --format TMPLATE_FORMAT
        --output-format FORMAT
        --skip-replace-underscore
        --deletion-policy-retain
    -p, --parameters KEY_VALUES
    -j, --json-parameters JSON
    -e, --encrypt-parameters KEYS
        --encryption-password PASS
        --skip-send-password
        --capabilities CAPABILITIES
        --disable-rollback
        --notify SNS_TOPICS
        --timeout MINUTES
        --result-log PATH
        --command-result-log PATH
        --detach
        --force
    -w, --ignore-all-space
        --color
        --no-color
        --debug
    -v, --verbose
</code></pre>

<h3>
<a id="kumogata_options" class="anchor" href="#kumogata_options" aria-hidden="true"><span class="octicon octicon-link"></span></a>KUMOGATA_OPTIONS</h3>

<p><code>KUMOGATA_OPTIONS</code> variable specifies default options.</p>

<p>e.g. <code>KUMOGATA_OPTIONS='-e Password'</code></p>

<h3>
<a id="create-resources" class="anchor" href="#create-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create resources</h3>

<pre><code>$ kumogata create template.rb
</code></pre>

<p>If you want to save the stack, please specify the stack name:</p>

<pre><code>$ kumogata create template.rb any_stack_name
</code></pre>

<p>If you want to pass parameters, please use <code>-p</code> option:</p>

<pre><code>$ kumogata create template.rb -p "InstanceType=m1.large,KeyName=any_other_key"
</code></pre>

<p><strong>Notice</strong></p>

<p><strong>The stack will be delete if you do not specify the stack name explicitly.</strong>
(And only the resources will remain)</p>

<h3>
<a id="convert-json-to-ruby" class="anchor" href="#convert-json-to-ruby" aria-hidden="true"><span class="octicon octicon-link"></span></a>Convert JSON to Ruby</h3>

<p>JSON template can be converted to Ruby template.</p>

<pre><code>$ kumogata convert https://s3.amazonaws.com/cloudformation-templates-us-east-1/Drupal_Single_Instance.template
</code></pre>

<ul>
<li>Data that cannot be converted will be converted to Array and Hash</li>
<li>
<code>::</code> is converted to <code>__</code>

<ul>
<li>
<code>Fn::GetAtt</code> =&gt; <code>Fn__GetAtt</code>
</li>
</ul>
</li>
<li>
<code>_{ ... }</code> is convered to Hash

<ul>
<li>
<code>SecurityGroups [_{Ref "WebServerSecurityGroup"}]</code> =&gt; <code>{"SecurityGroups": [{"Ref": "WebServerSecurityGroup"}]}</code>
</li>
</ul>
</li>
<li>
<code>_path()</code> creates Hash that has a key of path

<ul>
<li>
<code>_path("/etc/passwd-s3fs") { content "..." }</code> =&gt; <code>{"/etc/passwd-s3fs": {"content": "..."}}</code>
</li>
</ul>
</li>
<li>
<del>_user_data() creates Base64-encoded UserData</del>

<ul>
<li>
<code>_user_data()</code> has been removed</li>
</ul>
</li>
<li>
<code>_join()</code> has been removed</li>
</ul>

<h3>
<a id="stringfn_join" class="anchor" href="#stringfn_join" aria-hidden="true"><span class="octicon octicon-link"></span></a>String#fn_join()</h3>

<p>Ruby templates will be converted as follows by <code>String#fn_join()</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">UserData</span> <span class="pl-k">do</span>
  <span class="pl-vo">Fn__Base64</span> (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).fn_join</span>
<span class="pl-s1">    #!/bin/bash</span>
<span class="pl-s1">    /opt/aws/bin/cfn-init -s &lt;%= Ref "AWS::StackName" %&gt; -r myEC2Instance --region &lt;%= Ref "AWS::Region" %&gt;</span>
<span class="pl-s1"><span class="pl-pds">  EOS</span></span>
<span class="pl-k">end</span></pre></div>

<div class="highlight highlight-javascript"><pre><span class="pl-s1"><span class="pl-pds">"</span>UserData<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
  <span class="pl-s1"><span class="pl-pds">"</span>Fn::Base64<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s1"><span class="pl-pds">"</span>Fn::Join<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
      <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,
      [
        <span class="pl-s1"><span class="pl-pds">"</span>#!/bin/bash<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>/opt/aws/bin/cfn-init -s <span class="pl-pds">"</span></span>,
        {
          <span class="pl-s1"><span class="pl-pds">"</span>Ref<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::StackName<span class="pl-pds">"</span></span>
        },
        <span class="pl-s1"><span class="pl-pds">"</span> -r myEC2Instance --region <span class="pl-pds">"</span></span>,
        {
          <span class="pl-s1"><span class="pl-pds">"</span>Ref<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::Region<span class="pl-pds">"</span></span>
        },
        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>
      ]
    ]
  }
}</pre></div>

<h3>
<a id="split-a-template-file" class="anchor" href="#split-a-template-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Split a template file</h3>

<ul>
<li>template.rb</li>
</ul>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">Resources</span> <span class="pl-k">do</span>
  _include <span class="pl-s1"><span class="pl-pds">'</span>template2.rb<span class="pl-pds">'</span></span>
<span class="pl-k">end</span></pre></div>

<ul>
<li>template2.rb</li>
</ul>

<div class="highlight highlight-ruby"><pre>myEC2Instance <span class="pl-k">do</span>
  <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>
  <span class="pl-vo">Properties</span> <span class="pl-k">do</span>
    <span class="pl-vo">ImageId</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>
    <span class="pl-vo">InstanceType</span> { <span class="pl-vo">Ref</span> <span class="pl-s1"><span class="pl-pds">"</span>InstanceType<span class="pl-pds">"</span></span> }
    <span class="pl-vo">KeyName</span> <span class="pl-s1"><span class="pl-pds">"</span>your_key_name<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<ul>
<li>Converted JSON template</li>
</ul>

<div class="highlight highlight-javascript"><pre>{
  <span class="pl-s1"><span class="pl-pds">"</span>Resources<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s1"><span class="pl-pds">"</span>myEC2Instance<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
      <span class="pl-s1"><span class="pl-pds">"</span>Type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>Properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s1"><span class="pl-pds">"</span>ImageId<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span>InstanceType<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
          <span class="pl-s1"><span class="pl-pds">"</span>Ref<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>InstanceType<span class="pl-pds">"</span></span>
        },
        <span class="pl-s1"><span class="pl-pds">"</span>KeyName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>your_key_name<span class="pl-pds">"</span></span>
      }
    }
  }
}</pre></div>

<h3>
<a id="encrypt-parameters" class="anchor" href="#encrypt-parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encrypt parameters</h3>

<ul>
<li>Command line</li>
</ul>

<pre><code>$ kumogata create template.rb -e 'Password1,Password2' -p 'Param1=xxx,Param2=xxx,Password1=xxx,Password2=xxx'
</code></pre>

<ul>
<li>Template</li>
</ul>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">Parameters</span> <span class="pl-k">do</span>
  <span class="pl-vo">Param1</span> { <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span> }
  <span class="pl-vo">Param2</span> { <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span> }
  <span class="pl-vo">Password1</span> { <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span>; <span class="pl-vo">NoEcho</span> <span class="pl-c1">true</span> }
  <span class="pl-vo">Password2</span> { <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>String<span class="pl-pds">"</span></span>; <span class="pl-vo">NoEcho</span> <span class="pl-c1">true</span> }
<span class="pl-k">end</span> <span class="pl-c"># Parameters</span>

<span class="pl-vo">Resources</span> <span class="pl-k">do</span>
  myEC2Instance <span class="pl-k">do</span>
    <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>

    <span class="pl-vo">Properties</span> <span class="pl-k">do</span>
      <span class="pl-vo">ImageId</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>

      <span class="pl-vo">UserData</span> <span class="pl-k">do</span>
        <span class="pl-vo">Fn__Base64</span> (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).fn_join</span>
<span class="pl-s1">          #!/bin/bash</span>
<span class="pl-s1">          /opt/aws/bin/cfn-init -s &lt;%= Ref "AWS::StackName" %&gt; -r myEC2Instance --region &lt;%= Ref "AWS::Region" %&gt;</span>
<span class="pl-s1"><span class="pl-pds">        EOS</span></span>
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>

    <span class="pl-vo">Metadata</span> <span class="pl-k">do</span>
      <span class="pl-vo">AWS__CloudFormation__Init</span> <span class="pl-k">do</span>
        config <span class="pl-k">do</span>
          commands <span class="pl-k">do</span>
            any_command <span class="pl-k">do</span>
              command (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).fn_join</span>
<span class="pl-s1">                ENCRYPTION_PASSWORD="`echo '&lt;%= Ref Kumogata::ENCRYPTION_PASSWORD %&gt;' | base64 -d`"</span>
<span class="pl-s1"></span>
<span class="pl-s1">                # Decrypt Password1</span>
<span class="pl-s1">                echo '&lt;%= Ref "Password1" %&gt;' | base64 -d | openssl enc -d -aes256 -pass pass:"$ENCRYPTION_PASSWORD" &gt; password1</span>
<span class="pl-s1"></span>
<span class="pl-s1">                # Decrypt Password2</span>
<span class="pl-s1">                echo '&lt;%= Ref "Password2" %&gt;' | base64 -d | openssl enc -d -aes256 -pass pass:"$ENCRYPTION_PASSWORD" &gt; password2</span>
<span class="pl-s1"><span class="pl-pds">              EOS</span></span>
            <span class="pl-k">end</span>
          <span class="pl-k">end</span>
        <span class="pl-k">end</span>
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span> <span class="pl-c"># myEC2Instance</span>
<span class="pl-k">end</span> <span class="pl-c"># Resources</span></pre></div>

<h2>
<a id="iteration" class="anchor" href="#iteration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Iteration</h2>

<p>You can use the Iteration in the template using <code>_(...)</code> method.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">Resources</span> <span class="pl-k">do</span>
  [<span class="pl-s1"><span class="pl-pds">'</span>instance1<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>instance2<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>instance3<span class="pl-pds">'</span></span>].echo {|<span class="pl-vo">instance_name</span>|
    _(instance_name) <span class="pl-k">do</span>
      <span class="pl-vo">Type</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>
      <span class="pl-vo">Properties</span> <span class="pl-k">do</span>
        <span class="pl-vo">ImageId</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>
        <span class="pl-vo">InstanceType</span> { <span class="pl-vo">Ref</span> <span class="pl-s1"><span class="pl-pds">"</span>InstanceType<span class="pl-pds">"</span></span> }
        <span class="pl-vo">KeyName</span> <span class="pl-s1"><span class="pl-pds">"</span>your_key_name<span class="pl-pds">"</span></span>

        <span class="pl-vo">UserData</span> (<span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span>).undent.encode64</span>
<span class="pl-s1">          #!/bin/bash</span>
<span class="pl-s1">          yum install -y httpd</span>
<span class="pl-s1">          service httpd start</span>
<span class="pl-s1">          hostname <span class="pl-pse">#{</span><span class="pl-s2">instance_name</span><span class="pl-pse"><span class="pl-s2">}</span></span></span>
<span class="pl-s1"><span class="pl-pds">        EOS</span></span>
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
  }
<span class="pl-k">end</span></pre></div>

<h2>
<a id="post-command" class="anchor" href="#post-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>Post command</h2>

<p>You can run shell/ssh commands after building servers using <code>_post()</code>.</p>

<ul>
<li>Template</li>
</ul>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">Parameters</span> <span class="pl-k">do</span>
  ...
<span class="pl-k">end</span>

<span class="pl-vo">Resources</span> <span class="pl-k">do</span>
  ...
<span class="pl-k">end</span>

<span class="pl-vo">Outputs</span> <span class="pl-k">do</span>
  <span class="pl-vo">MyPublicIp</span> <span class="pl-k">do</span>
    <span class="pl-vo">Value</span> { <span class="pl-vo">Fn__GetAtt</span> name, <span class="pl-s1"><span class="pl-pds">"</span>PublicIp<span class="pl-pds">"</span></span> }
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

_post <span class="pl-k">do</span>
  my_shell_command <span class="pl-k">do</span>
    command <span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span></span>
<span class="pl-s1">      echo &lt;%= Key "MyPublicIp" %&gt;</span>
<span class="pl-s1"><span class="pl-pds">    EOS</span></span>
  <span class="pl-k">end</span>
  my_ssh_command <span class="pl-k">do</span>
    ssh <span class="pl-k">do</span>
      host { <span class="pl-vo">Key</span> <span class="pl-s1"><span class="pl-pds">"</span>MyPublicIp<span class="pl-pds">"</span></span> } <span class="pl-c"># or '&lt;%= Key "MyPublicIp" %&gt;'</span>
      user <span class="pl-s1"><span class="pl-pds">"</span>ec2-user<span class="pl-pds">"</span></span>
      <span class="pl-c"># see http://net-ssh.github.io/net-ssh/classes/Net/SSH.html#method-c-start</span>
      <span class="pl-c">#options :timeout =&gt; 300</span>
      <span class="pl-c">#connect_tries 36</span>
      <span class="pl-c">#retry_interval 5</span>
      <span class="pl-c">#request_pty true</span>
    <span class="pl-k">end</span>
    command <span class="pl-s1"><span class="pl-pds">&lt;&lt;-EOS</span></span>
<span class="pl-s1">      hostname</span>
<span class="pl-s1"><span class="pl-pds">    EOS</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<ul>
<li>Execution result</li>
</ul>

<pre><code>...
Command: my_shell_command
Status: 0
1&gt; 54.199.251.30

Command: my_ssh_command
Status: 0
1&gt; ip-10-0-129-20

(Save to `/foo/bar/command_result.json`)
</code></pre>

<h2>
<a id="javascript-template" class="anchor" href="#javascript-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>JavaScript template</h2>

<p>You can also use the JavaScript template instead of JSON and Ruby.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-st">function</span> <span class="pl-en">fetch_ami</span>() {
  <span class="pl-k">return</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>;
}

<span class="pl-c">/* For JS Object is evaluated last, it must be enclosed in parentheses */</span>
({
  Resources<span class="pl-k">:</span> { <span class="pl-c">/* comment */</span>
    myEC2Instance<span class="pl-k">:</span> {
      Type<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>,
      Properties<span class="pl-k">:</span> {
        ImageId<span class="pl-k">:</span> fetch_ami(),
        InstanceType<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>t1.micro<span class="pl-pds">"</span></span>
      }
    }
  },
  Outputs<span class="pl-k">:</span> {
    AZ<span class="pl-k">:</span> { <span class="pl-c">/* comment */</span>
      Value<span class="pl-k">:</span> {
        <span class="pl-s1"><span class="pl-pds">"</span>Fn::GetAtt<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
          <span class="pl-s1"><span class="pl-pds">"</span>myEC2Instance<span class="pl-pds">"</span></span>,
          <span class="pl-s1"><span class="pl-pds">"</span>AvailabilityZone<span class="pl-pds">"</span></span>
        ]
      }
    }
  }
})

<span class="pl-c">/*</span>
<span class="pl-c"> {</span>
<span class="pl-c">   "Resources": {</span>
<span class="pl-c">     "myEC2Instance": {</span>
<span class="pl-c">       "Type": "AWS::EC2::Instance",</span>
<span class="pl-c">       "Properties": {</span>
<span class="pl-c">         "ImageId": "ami-XXXXXXXX",</span>
<span class="pl-c">         "InstanceType": "t1.micro"</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   },</span>
<span class="pl-c">   "Outputs": {</span>
<span class="pl-c">     "AZ": {</span>
<span class="pl-c">       "Value": {</span>
<span class="pl-c">         "Fn::GetAtt": [</span>
<span class="pl-c">           "myEC2Instance",</span>
<span class="pl-c">           "AvailabilityZone"</span>
<span class="pl-c">         ]</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   }</span>
<span class="pl-c"> }</span>
<span class="pl-c"> */</span></pre></div>

<h3>
<a id="convert-json-template-to-javascript" class="anchor" href="#convert-json-template-to-javascript" aria-hidden="true"><span class="octicon octicon-link"></span></a>Convert JSON template to JavaScript</h3>

<pre><code>$ kumogata convert Drupal_Single_Instance.template --output-format=js
</code></pre>

<h2>
<a id="coffeescript-template" class="anchor" href="#coffeescript-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>CoffeeScript template</h2>

<p>You can also use the CoffeeScript template instead of JSON and Ruby.</p>

<div class="highlight highlight-coffeescript"><pre><span class="pl-en">fetch_ami </span><span class="pl-k">=</span><span class="pl-vpf"> <span class="pl-vpf">()</span></span> <span class="pl-st"><span class="pl-st">-&gt;</span></span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>

<span class="pl-k">/*</span> For JS <span class="pl-s3">Object</span> <span class="pl-k">is</span> evaluated last, it must use <span class="pl-s1"><span class="pl-pds">`</span><span class="pl-k">return</span><span class="pl-pds">`</span></span> <span class="pl-k">*/</span>
<span class="pl-k">return</span> {
  <span class="pl-v"><span class="pl-v">Resources:</span></span>
    <span class="pl-v"><span class="pl-v">myEC2Instance:</span></span>
      <span class="pl-v"><span class="pl-v">Type:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>,
      <span class="pl-v"><span class="pl-v">Properties:</span></span>
        <span class="pl-v"><span class="pl-v">ImageId:</span></span> fetch_ami(),
        <span class="pl-v"><span class="pl-v">InstanceType:</span></span> <span class="pl-s1"><span class="pl-pds">"</span>t1.micro<span class="pl-pds">"</span></span>
  <span class="pl-v"><span class="pl-v">Outputs:</span></span>
    <span class="pl-v"><span class="pl-v">AZ:</span></span> <span class="pl-c"># comment</span>
      <span class="pl-v"><span class="pl-v">Value:</span></span>
        <span class="pl-s1"><span class="pl-pds">"</span>Fn::GetAtt<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
          <span class="pl-s1"><span class="pl-pds">"</span>myEC2Instance<span class="pl-pds">"</span></span>,
          <span class="pl-s1"><span class="pl-pds">"</span>AvailabilityZone<span class="pl-pds">"</span></span>
        ]
}

<span class="pl-c">###</span>
<span class="pl-c"> {</span>
<span class="pl-c">   "Resources": {</span>
<span class="pl-c">     "myEC2Instance": {</span>
<span class="pl-c">       "Type": "AWS::EC2::Instance",</span>
<span class="pl-c">       "Properties": {</span>
<span class="pl-c">         "ImageId": "ami-XXXXXXXX",</span>
<span class="pl-c">         "InstanceType": "t1.micro"</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   },</span>
<span class="pl-c">   "Outputs": {</span>
<span class="pl-c">     "AZ": {</span>
<span class="pl-c">       "Value": {</span>
<span class="pl-c">         "Fn::GetAtt": [</span>
<span class="pl-c">           "myEC2Instance",</span>
<span class="pl-c">           "AvailabilityZone"</span>
<span class="pl-c">         ]</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   }</span>
<span class="pl-c"> }</span>
<span class="pl-c">###</span></pre></div>

<h2>
<a id="yaml-template" class="anchor" href="#yaml-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>YAML template</h2>

<p>You can also use the YAML template instead of JSON and Ruby.</p>

<div class="highlight highlight-yaml"><pre><span class="pl-s1">-<span class="pl-s1">--</span></span>
<span class="pl-s1"><span class="pl-ent">Resources:</span></span>
  <span class="pl-s1"><span class="pl-ent">myEC2Instance:</span></span>
    <span class="pl-s1"><span class="pl-ent">Type:</span> <span class="pl-s1">AWS::EC2::Instance</span></span>
    <span class="pl-s1"><span class="pl-ent">Properties:</span></span>
      <span class="pl-s1"><span class="pl-ent">ImageId:</span> <span class="pl-s1">ami-XXXXXXXX</span></span>
      <span class="pl-s1"><span class="pl-ent">InstanceType:</span> <span class="pl-s1">t1.micro</span></span>
<span class="pl-s1"><span class="pl-ent">Outputs:</span></span>
  <span class="pl-s1"><span class="pl-ent">AZ:</span></span>
    <span class="pl-s1"><span class="pl-ent">Value:</span></span>
      <span class="pl-s1"><span class="pl-ent">Fn::GetAtt:</span></span>
      <span class="pl-s1">- <span class="pl-s1">myEC2Instance</span></span>
      <span class="pl-s1">- <span class="pl-s1">AvailabilityZone</span></span>

<span class="pl-c"># {</span>
<span class="pl-c">#   "Resources": {</span>
<span class="pl-c">#     "myEC2Instance": {</span>
<span class="pl-c">#       "Type": "AWS::EC2::Instance",</span>
<span class="pl-c">#       "Properties": {</span>
<span class="pl-c">#         "ImageId": "ami-XXXXXXXX",</span>
<span class="pl-c">#         "InstanceType": "t1.micro"</span>
<span class="pl-c">#       }</span>
<span class="pl-c">#     }</span>
<span class="pl-c">#   },</span>
<span class="pl-c">#   "Outputs": {</span>
<span class="pl-c">#     "AZ": {</span>
<span class="pl-c">#       "Value": {</span>
<span class="pl-c">#         "Fn::GetAtt": [</span>
<span class="pl-c">#           "myEC2Instance",</span>
<span class="pl-c">#           "AvailabilityZone"</span>
<span class="pl-c">#         ]</span>
<span class="pl-c">#       }</span>
<span class="pl-c">#     }</span>
<span class="pl-c">#   }</span>
<span class="pl-c"># }</span></pre></div>

<h3>
<a id="convert-json-template-to-yaml" class="anchor" href="#convert-json-template-to-yaml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Convert JSON template to YAML</h3>

<pre><code>$ kumogata convert Drupal_Single_Instance.template --output-format=yaml
</code></pre>

<h2>
<a id="json5-template" class="anchor" href="#json5-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<a href="http://json5.org/">JSON5</a> template</h2>

<p>You can also use the <a href="http://json5.org/">JSON5</a> template instead of JSON and Ruby.</p>

<div class="highlight highlight-javascript"><pre>{
  Resources<span class="pl-k">:</span> { <span class="pl-c">/* comment */</span>
    myEC2Instance<span class="pl-k">:</span> {
      Type<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>AWS::EC2::Instance<span class="pl-pds">"</span></span>,
      Properties<span class="pl-k">:</span> {
        ImageId<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>ami-XXXXXXXX<span class="pl-pds">"</span></span>,
        InstanceType<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>t1.micro<span class="pl-pds">"</span></span>
      }
    }
  },
  Outputs<span class="pl-k">:</span> {
    AZ<span class="pl-k">:</span> { <span class="pl-c">/* comment */</span>
      Value<span class="pl-k">:</span> {
        <span class="pl-s1"><span class="pl-pds">"</span>Fn::GetAtt<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
          <span class="pl-s1"><span class="pl-pds">"</span>myEC2Instance<span class="pl-pds">"</span></span>,
          <span class="pl-s1"><span class="pl-pds">"</span>AvailabilityZone<span class="pl-pds">"</span></span>
        ]
      }
    }
  }
}

<span class="pl-c">/*</span>
<span class="pl-c"> {</span>
<span class="pl-c">   "Resources": {</span>
<span class="pl-c">     "myEC2Instance": {</span>
<span class="pl-c">       "Type": "AWS::EC2::Instance",</span>
<span class="pl-c">       "Properties": {</span>
<span class="pl-c">         "ImageId": "ami-XXXXXXXX",</span>
<span class="pl-c">         "InstanceType": "t1.micro"</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   },</span>
<span class="pl-c">   "Outputs": {</span>
<span class="pl-c">     "AZ": {</span>
<span class="pl-c">       "Value": {</span>
<span class="pl-c">         "Fn::GetAtt": [</span>
<span class="pl-c">           "myEC2Instance",</span>
<span class="pl-c">           "AvailabilityZone"</span>
<span class="pl-c">         ]</span>
<span class="pl-c">       }</span>
<span class="pl-c">     }</span>
<span class="pl-c">   }</span>
<span class="pl-c"> }</span>
<span class="pl-c"> */</span></pre></div>

<h2>
<a id="outputs-filter" class="anchor" href="#outputs-filter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Outputs Filter</h2>

<div class="highlight highlight-ruby"><pre><span class="pl-vo">Outputs</span> <span class="pl-k">do</span>
  <span class="pl-vo">MyPublicIp</span> <span class="pl-k">do</span>
    <span class="pl-vo">Value</span> { <span class="pl-vo">Fn__GetAtt</span> <span class="pl-s1"><span class="pl-pds">"</span>MyInstance<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>PublicIp<span class="pl-pds">"</span></span> }
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

_outputs_filter <span class="pl-k">do </span>|<span class="pl-vo">output</span>|
  outputs[<span class="pl-s1"><span class="pl-pds">"</span>MyPublicIp<span class="pl-pds">"</span></span>].gsub!(<span class="pl-s1"><span class="pl-pds">'</span>.<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>_<span class="pl-pds">'</span></span>)
  <span class="pl-c"># MyPublicIp: XXX.XXX.XXX.XXX =&gt; XXX-XXX-XXX-XXX</span>
<span class="pl-k">end</span>

_post <span class="pl-k">do</span>
  ...
<span class="pl-k">end</span></pre></div>

<h2>
<a id="configuration-file" class="anchor" href="#configuration-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration File</h2>

<p>Kumogata supports <a href="http://docs.aws.amazon.com/AWSSdkDocsRuby/latest/DeveloperGuide/ruby-dg-setup.html#set-up-creds">aws-sdk configuration file</a>.</p>

<pre><code>[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
aws_session_token=texample123324
</code></pre>

<h2>
<a id="demo" class="anchor" href="#demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demo</h2>

<ul>
<li>Create resources

<ul>
<li><a href="https://asciinema.org/a/7979">https://asciinema.org/a/7979</a></li>
</ul>
</li>
<li>Convert a template

<ul>
<li><a href="https://asciinema.org/a/7980">https://asciinema.org/a/7980</a></li>
</ul>
</li>
<li>Create a stack while outputting the event log

<ul>
<li><a href="https://asciinema.org/a/8075">https://asciinema.org/a/8075</a></li>
</ul>
</li>
<li>Create a stack and run post commands

<ul>
<li><a href="https://asciinema.org/a/8088">https://asciinema.org/a/8088</a></li>
</ul>
</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it ( <a href="http://github.com/winebarrel/kumogata/fork">http://github.com/winebarrel/kumogata/fork</a> )</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Kumogata maintained by <a href="https://github.com/winebarrel">winebarrel</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
